---
title: On Hugo
date: 2021-02-11
teaser: |-
  After having it on my to-do list for several years, I finally got around to trying out a <a href="https://staticsitegenerators.net/">static site generator</a> (SSG). In particular, <a href="https://gohugo.io/">Hugo</a>. I decided to take Hugo for a spin, by rebuilding one of my golden oldies, <a href="https://worldtrip.greenash.net.au/">Jaza's World Trip</a>, with it. And, for bonus points, I <a href="https://github.com/Jaza/worldtrip">published the source code</a> on GitHub, and I deployed the site on <a href="https://www.netlify.com/">Netlify</a>. Hugo is <a href="https://github.com/gohugoio/hugo">great software</a> with a <a href="https://discourse.gohugo.io/">great community</a>, however it didn't quite live up to my expectations.
tags:
  - thoughtstopics/golang
  - thoughtstopics/hugo
  - thoughtstopics/programming
---
After having it on my to-do list for several years, I finally got around to trying out a <a href="https://staticsitegenerators.net/">static site generator</a> (SSG). In particular, <a href="https://gohugo.io/">Hugo</a>. I decided to take Hugo for a spin, by rebuilding one of my golden oldies, <a href="https://worldtrip.greenash.net.au/">Jaza's World Trip</a>, with it. And, for bonus points, I <a href="https://github.com/Jaza/worldtrip">published the source code</a> on GitHub, and I deployed the site on <a href="https://www.netlify.com/">Netlify</a>. Hugo is <a href="https://github.com/gohugoio/hugo">great software</a> with a <a href="https://discourse.gohugo.io/">great community</a>, however it didn't quite live up to my expectations.

[thumbnail hugo-gopher.png Hugo: fast like a... gopher?<br><em>Image source:</em> <a href="https://gohugo.io/">Hugo</a>]

<h2>Memory lane</h2>

To give you a bit of history: worldtrip was originally built in <a href="https://www.drupal.org/">Drupal</a> (version <a href="https://www.drupal.org/forum/general/news-and-announcements/2006-05-01/drupal-470-released">4.7</a>), back in 2007. So it started its life as a real, old-school, PHP CMS driven blog. I actually wrote most of the blog entries from internet caf√©s around the world, by logging in and typing away &ndash; often while struggling with a non-English keyboard, a bad internet connection, a sluggish machine, and a malware-infested old Windows. Ah, the memories! And people posted comments too.

Then, in 2014, I converted it to a "static PHP site", which I custom-built. It was static as in "no database" &ndash; all the content <a href="https://greenash.net.au/thoughts/2014/05/database-free-content-tagging-with-files-and-glob/">was in flat files</a>, virtually identical to the "content files" of Hugo and other SSGs &ndash; but not quite static as in "plain HTML files". It was still PHP, and so it still needed to be served by a PHP-capable web server (like Apache or Nginx with their various modules).

In retrospect, maybe I should have SSG-ified worldtrip in 2014. But SSGs still weren't much of a thing back then: Hugo was in its infancy; Netlify didn't exist yet; nor did any of the JS-based <a href="https://gatsbyjs.com/">cool</a> new <a href="https://nextjs.org/">kids</a>. The original SSG, <a href="https://jekyllrb.com/">Jekyll</a>, was around, but it wasn't really on my radar (I didn't try out Jekyll until around 2016, and I never ended up building or deploying a finished site with it). Plus I still wasn't quite ready to end my decade-long love affair with PHP (I finally got out of that toxic relationship for good, a few years later). Nor was I able to yet embrace the idea of hosting a whole web site on anything other than an old-school box: for a decade or so, all I had known was "shared hosting" and VPSes.

<h2>Hugo time</h2>

So, it's 2021, and I've converted worldtrip yet again, this time to Hugo. It's pretty much unchanged on the surface. The main difference is that the trip photos (both in the "gallery" section, and embedded in blog posts) are now sourced from an S3 bucket instead of from Flickr (I needed to make this change in order to <a href="https://greenash.net.au/thoughts/2021/02/private-photo-collections-with-awspics/">retire my Flickr account</a>). I also converted the location map from a Google map to a Leaflet / Mapbox map (this was also needed, as <a href="https://www.endpoint.com/blog/2019/03/23/switching-google-maps-leaflet">Google now charges</a> for even the simplest Maps API usage). I could have made those changes without re-building the whole site, but they were a good excuse to do just that.

[thumbnail worldtrip-location-map.png The Leaflet and Mapbox powered location map.]

True <a href="https://css-tricks.com/comparing-static-site-generator-build-times/">to its word</a>, I can attest that Hugo is <a href="https://forestry.io/blog/hugo-vs-jekyll-benchmark/">indeed fast</a>. On my local machine, Hugo generates all of the 2,000+ pages of worldtrip in a little over 2 seconds. And deploying it on Netlify is indeed easy-peasy. And free &ndash; including with a custom domain, with SSL, with quite generous bandwidth, with plenty of build minutes &ndash; so kudos to Netlify (and I hope they keep on being so generous!).

Hugo had pretty much everything I needed, to make re-building worldtrip a breeze: <a href="https://gohugo.io/content-management/types/">content types</a>, <a href="https://gohugo.io/content-management/front-matter/">front matter</a>, <a href="https://gohugo.io/content-management/taxonomies/">taxonomies</a>, <a href="https://gohugo.io/content-management/menus/">menus</a>, <a href="https://gohugo.io/content-management/urls/">customisable URLs</a>, templating (including <a href="https://gohugo.io/templates/partials/">partials</a> and <a href="https://gohugo.io/templates/shortcode-templates/">shortcodes</a>), <a href="https://gohugo.io/templates/pagination/">pagination</a>, and <a href="https://gohugo.io/variables/page/">previous / next</a> links. It didn't support absolutely all of worldtrip's features out-of-the-box &ndash; but then again, nothing ever does, right? And filling in those remaining gaps was going to be easy, right?

As it turns out, building custom functionality in Hugo is quite hard.

The first pain point that I hit, was worldtrip's multi-level (country / city) taxonomy hierarchy. Others have <a href="https://discourse.gohugo.io/t/multi-level-taxonomy/4888/15">shared their grief</a> with this, and I shared mine there too. I got it working, but only by coding way more logic into a template than should have been necessary, and by abusing the s%#$ out of Hugo templating's <a href="https://gohugo.io/functions/scratch/">scratch</a> feature. The <a href="https://github.com/Jaza/worldtrip/blob/master/layouts/partials/countriesandcities.html">resulting partial</a> template is an unreadable abomination. It could have been a nice, clean, testable function (and it previously was one, in PHP), were I able to write any actual code in a Hugo site (in Go or in any other language). But no, you can't write actual code in a Hugo site, you can only write template logic.

<strong>Update:</strong> I just discovered that <a href="https://github.com/gohugoio/hugo/issues/5783">support for <code>return</code>'ing a value</a> of any type (rather than just rendering a string) <a href="https://github.com/gohugoio/hugo/pull/5788">was added to Hugo</a> a few years back (and is documented, albeit rather tersely). So I could rely on Hugo's scratch a bit less, if I were to instead <code>return</code> the countries / cities array. But the logic still has to live in a template!

Same with the tag cloud. It's not such a big deal, it's a problem that <a href="https://discourse.gohugo.io/t/weighted-tag-cloud/3491/10">various people have solved</a> at the template level, and I did so too. What I did for <a href="https://github.com/Jaza/worldtrip/blob/master/layouts/partials/weightedtags.html">weighted tags</a> isn't totally illegible. But again, it was previously (pre-Hugo) implemented as a nice actual function in code, and now it's shoved into template logic.

[thumbnail worldtrip-tag-cloud.png The weighted tag cloud.]

The photo gallery was cause for considerable grief too. Because I didn't want an individual page to be rendered for each photo, my first approach was to define the gallery items in <a href="https://gohugo.io/templates/data-templates/">data files</a>. But I needed the listing to be paginated, and I soon discovered that Hugo's pagination only supports page collections, not arbitrary lists of data (why?!). So, take two, I defined them as <a href="https://gohugo.io/content-management/page-bundles/">headless bundles</a>. But it just so happens that listing headless bundles (as opposed to just retrieving a single one) <a href="https://discourse.gohugo.io/t/how-to-iterate-over-headless-pages/12536/21">is a right pain</a>, and if you're building up a list of them and then paginating that list, it's also hacky and very inefficient (when I tried it, my site took 4x longer to build, because it was calling <a href="https://gohugo.io/functions/readdir/"><code>readDir</code></a> on the whole photo directory, for each paginated chunk).

Finally, I stumbled across Hugo's (quite new) <a href="https://gohugo.io/content-management/build-options/">"no render"</a> feature, and I was able to define and paginate my gallery items (without having a stand-alone page for each photo) in an efficient and non-hacky way, by specifying the build options <code>render = "never"</code> and <code>list = "local"</code>. I also fixed a bug in Hugo itself (my first tiny bit of code written in <a href="https://golang.org/">golang</a>!), to <a href="https://github.com/gohugoio/hugo/pull/8201">exclude "no render" pages from the sitemap</a> (as of writing, the fix has been merged but not included in a stable Hugo release), thus making it safe(r) to specify <code>list = "always"</code> (which you might need, instead of <code>list = "local"</code>, if you want to list your items anywhere else on the site, other than on their parent page). So, at least with the photo gallery &ndash; in contrast to my other above-mentioned Hugo pain points &ndash; I'm satisfied with the end result. Nevertheless, a more-than-warranted amount of hair tearing-out did occur.

The worldtrip monthly archive wasn't particularly hard to implement, <a href="https://blog.atj.me/2017/10/generate-yearly-and-monthly-archive-pages-with-hugo-sections/">thanks to this guide</a> that I followed quite closely. But I was disappointed that I had to create a physical "page" content file for each month, in order for Hugo to render it. Because guess what, Hugo <a href="https://discourse.gohugo.io/t/pagination-and-group-by-date/1441/10">doesn't have built-in support</a> for chronological archive pages! And because, since Hugo offers <a href="https://forestry.io/blog/hugo-and-jekyll-compared/">no real mechanism</a> for you to write code anywhere to (programmatically) render such pages, you just have to hack around that limitation. I didn't do what the author of that guide did (he added a stand-alone Node.js script to generate more archive "page" content files when needed), because worldtrip is a retired site that will never need more such pages generated, and because I'd rather avoid having totally-separate-to-Hugo build scripts like that. The <a href="https://github.com/Jaza/worldtrip/blob/master/layouts/monthly-archive/single.html">monthly archive templates</a> also contain <a href="https://github.com/Jaza/worldtrip/blob/master/layouts/blog/monthly-archive.html">more logic</a> than they ideally should.

[thumbnail worldtrip-monthly-archive.png The monthly archive index page.]

<h2>Mixed feelings</h2>

So, I succeeded in migrating worldtrip to Hugo. I can pat myself on the back, job well done, jolly good old chap. I don't regret having chosen Hugo: it really is fast; it's a well-written (to my novice golang eyes) and well-maintained open-source codebase; it boasts an active dev and support community; <a href="https://gohugo.io/documentation/">its documentation</a> is of a high standard; and it comes built-in with 95% of the functionality that any static site could possibly need.

I wanted, and I still want, to love Hugo, for those reasons. And just because it's golang (which I have vaguely been wanting to learn lately &hellip; although I have invested time in learning the basics of other languages over the past several years, namely Erlang and Rust). And because it really seems like the best-in-breed among SSGs: it's focused on the basics of HTML page generation (not trying to "solve React for static sites", or other such nonsense, at the same time); it takes performance and scalability seriously; and it fosters a good dev, design, and content authoring experience.

However, it seems that, by design, it's completely impossible to write custom code in an actual programming language (not in a presentation-layer template), that's hooked in to Hugo in any way (apart from by hacking Hugo core). I don't mind that Hugo is opinionated. Many great pieces of software are opinionated &ndash; <a href="https://www.djangoproject.com/">Django</a>, for example.

But Django is far more flexible: you can programmatically render any page, with <a href="https://docs.djangoproject.com/en/stable/topics/http/urls/">any URL</a>, that takes your fancy; you can move any presentational logic you want into procedural code (usually either in the <a href="https://docs.djangoproject.com/en/stable/topics/http/views/">view layer</a>, to populate template variables, or in <a href="https://docs.djangoproject.com/en/stable/howto/custom-template-tags/">custom template tags</a>), to keep your templates simple; and you can <a href="https://docs.djangoproject.com/en/stable/topics/db/models/">model your data</a> however you want (so you're free to implement something like a multi-level taxonomy yourself &ndash; although I admit that this isn't a fair apples vs apples comparison, as Django data is stored in a database). I realise that Django &ndash; and <a href="https://rubyonrails.org/">Rails</a>, and <a href="https://www.drupal.org/">Drupal</a>, and <a href="https://wordpress.org/">WordPress</a> &ndash; all generate dynamic sites; but that's no excuse, an SSG can and should allow the same level of flexibility via custom code.

[thumbnail flexible-hose.jpg Hugo is somewhat lacking in flexibility.<br><em>Image source:</em> <a href="https://pixabay.com/photos/hose-flexibility-equipment-tube-5478112/">pixabay</a>]

There has been some (but not that much) discussion about <a href="https://github.com/gohugoio/hugo/issues/6310">supporting custom code</a> in Hugo (mainly for the purpose of fetching and parsing custom data, but potentially for more things). There are technical challenges (mainly related to Go being a compiled language), but it would be possible (not necessarily in Go, various other real programming languages have been suggested). Also some mention of <a href="https://github.com/gohugoio/hugo/issues/311">custom template functions</a> (that thread is already quite old though). Nothing has been agreed upon or built to date. I for one will certainly watch this space.

For my next static site endeavour, at least, I think I'll take a different SSG for a spin. I'm thinking <a href="https://www.11ty.dev/">Eleventy</a>, which appears to allow a lot of custom code, albeit all JS. (And my next project will be a migration of another of my golden oldies, most likely <a href="http://jazasworld.greenash.net.au/">Jaza's World</a>, which has a similar tech history to worldtrip).

Will I use Hugo again? Probably. Will I contribute to Hugo more? If I have time, and if I have itches to scratch, then sure. However, I'm a dev, and <a href="https://greenash.net.au/thoughts/2021/01/good-devs-care-about-code/">I like to code</a>. And Hugo, despite having so much going for it, seems to be completely geared towards people who aren't devs, and who just want to publish content. So I don't see myself ever feeling "right at home" with Hugo.
