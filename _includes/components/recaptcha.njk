{%- if params.recaptchaKey %}
<div id="recaptcha-wrapper"></div>
<script type="text/javascript">
  let originalSubmitFormButtonText = '';

  const recaptchaOnloadCallback = () => {
    document.getElementById('submit-form-button').textContent = originalSubmitFormButtonText;
    grecaptcha.render('recaptcha-wrapper', {'sitekey': '{{ params.recaptchaKey }}'});
  };

  ready(() => {
    const submitButton = document.getElementById('submit-form-button');
    originalSubmitFormButtonText = submitButton.textContent;
    submitButton.textContent = 'Prepare to ' + originalSubmitFormButtonText;
    submitButton.addEventListener("click", e => {
      const agreeToCookiesMessage =
        'This will load Google reCAPTCHA, which will set cookies. Sadly, you will ' +
        'not be able to submit this form unless you agree. GDPR, not to mention ' +
        'basic human decency, dictates that you have a choice and a right to protect ' +
        'your privacy from the corporate overlords. Do you agree?';

      if (window.confirm(agreeToCookiesMessage)) {
        const recaptchaScript = document.createElement('script');
        script.setAttribute(
          'src',
          'https://www.google.com/recaptcha/api.js?onload=recaptchaOnloadCallback&render=explicit');
        script.setAttribute('async', '');
        script.setAttribute('defer', '');
        document.head.appendChild(script);
      }
    });
  });
</script>
{%- endif %}
